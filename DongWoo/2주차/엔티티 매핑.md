`# 엔티티 매핑
> JPA 에서 가장 중요한 두가지중 하나는 영속성 컨텍스트, JPA 내부 동작 방식(매커니즘) 측면이랑 다른 하나는 실제 설계적인 측면(객체와 관계형
> 데이터베이스를 어떻게 매핑해서 쓰는지)

### 엔티티 매핑 소개
- 객체와 테이블 매핑: @Entity, @Table
- 필드와 컬럼 매핑: @Column
- 기본 키 매핑: @Id
- 연관관계 매핑: @ManyToOne, @JoinColumn

## 객체와 테이블 매핑

### @Entity
- @Entity 가 붙으면 이건 JPA 가 관리하는 객체고 데이터베이스 테이블과 매핑해서 쓴다고 본다.
- @Entity 가 붙은 클래스는 JPA 가 관리, 엔티티라 한다
- JPA 를 사용해서 테이블과 매핑할 클래스는 @Entity 필수
- 주의할점
  1. 기본 생성자 필수(파라미터가 없는 public 또는 protected 생성자) -> JPA 가 구현하는 라이브러리들이
  동적으로 뭘하거나 리플렉션 같은 기술을 쓰려면 필요하기 때문
  2. final 클래스, enum, interface, inner 클래스 사용 불가
  3. DB 에 저장하고 싶은 필드에 final 사용 불가

### @Entity 속성
- 속성: name (@Entity(name = "Member"))
  1. JPA 에서 사용할 엔티티 이름을 지정한다.
  2. 기본값: 클래스 이름을 그대로 사용(예: Member)
  3. 같은 클래스 이름이 없으면 가급적 기본값을 사용한다.

### @Table
- @Table 은 엔티티와 매핑할 테이블 지정
-> 예를들어서 DBA 가 DB 이름 Member 라고 쓰시면 안되요 MBR 이라고 쓰셔야되요 라고 하면 @Table(name = "MBR") 이라고 쓰면되고
실제 INSERT 쿼리가 INSERT INTO MBR 로 나간다
 <img src="src/data1.png">
그밖에 이런 기능들도 있다

## 데이터베이스 스키마 자동 생성

- DDL 을 애플리케이션 실행 시점에 자동 생성
  -> JPA 에서는 어플리케이션 로딩 시점에 create 문으로 DB 를 생성하고 시작할 수 있다.
- 테이블 중심 -> 객체 중심 -> 개발할때, 테이블 먼저 막 만들어놓고 객체와서 개발하는데 JPA 는 그럴필요 없다
그냥 객체에서 만들고 객체 매핑해놓으면 애플리케이션 뜰때, 필요한 테이블 다 만들어 준다
- 데이터베이스 방언을 활용해서 데이터베이스에 맞는 적절한 DDL 생성 -> 데이터베이스 마다 다른 방언을 다 적절하게 맞춰서 해준다
- 이렇게 생성된 DDL 은 개발 장비에서만 사용
- 생성된 DDL은 운영서버에서는 사용하지 않거나, 적절히 다듬은 후 사용

### 데이터베이스 스키마 자동 생성 - 속성
 <img src="src/data2.png">
persistence.xml 에 보면 properties 에 hibernate.hbm2ddl.auto" value="create-drop
이게 있는데 이 값에 대한 속성들이다
 <img src="src/data3.png">

create-drop 은 종료 시점에 테이블을 DROP 하는데 이건 보통 test case 같은걸 실행하고 
마지막에 깔끔하게 싹다 날리고 싶을때 사용한다 

update 는 변경분만 반영하는데 테이블 속성 추가는 되지만 삭제는 안된다
 
### 데이터베이스 스키마 자동 생성 - 주의
- **운영 장비에는 절대 create, create-drop, update 사용하면 안된다.**
- 개발 초기 단계는 혼자 테스트로 create 또는 update 로 자기 로컬로 쓰면 된다
- 여려명의 개발자가 같이쓰는 중간 서버 테스트 서버는 update 또는 validate (create, update 쓰면 다 날라가잖아)
- 스테이징과 운영 서버는 validate 또는 none 쓴다

## 필드와 컬럼 매핑

``` java
@Entity
public class Member {
    @Id                //PK 매핑
    private Long id;   

    @Column(name = "name")    //객체는 username 이라 쓰고 싶은데 DB에는 
    private String username;  //name 이라고 써야되면 이렇게 하면 DB 컬럼 명은 name

    private Integer age;

    @Enumerated(EnumType.STRING)  //객체에서 enum 타입을 쓰고싶은데 DB 에는 enum 타입이 없다
    private RoleType roleType;    //그럼 @Enumerated 를 쓰면 된다

    @Temporal(TemporalType.TIMESTAMP) // @Temporal 에는 DATE, TIME, TIMESTAMP 3개가 있다 날짜, 시간, 날짜시간
    private Date createdDate;         

    @Temporal(TemporalType.TIMESTAMP)
    private Date lastModifiedDate;

    @Lob                            //데이터베이스에 VARCHAR 를 넘어서는 큰 컨텐츠를 넣고싶으면
    private String description;     // @Lob을 쓰면 된다
    
}

public enum RoleType {
    USER, ADMIN
}
```
이걸 실행하면
<img src="src/data4.png">
이렇게 뜬다
