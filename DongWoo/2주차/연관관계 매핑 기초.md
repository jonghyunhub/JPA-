# 연관관계 매핑 기초
테이블에 맞춰서 외래키 그대로 가져오는게 아니라 연관관계를 맺어서 객체지향스럽게 만드는 방식
객체와 관계형 DB 의 패러다임 차이에서 오는것 중 제일 어려운 내용

> 목표
> - **객체와 테이블 연관관계 차이를 이해**
> - **객체의 참조와 테이블의 외래키를 매핑**
> - 용어 이해
    >   - 방향: 단방향, 양방향
>   - 다중성: 다대일, 일대다, 일대일, 다대다 이해
>   - 연관관계 주인: 객체 양방향 연관관계는 관리 주인이 필요

> 예제 시나리오
> - 회원과 팀이 있다
> - 회원은 하나의 팀에만 소속될 수 있다
> - 회원과 팀은 다대일 관계이다

<img src="src/data20.png">

하나의 팀에 여러 멤버가 소속되고 여러멤버는 하나의 팀에 소속될 수 있다

이걸 객체를 테이블에 맞추어 모델링을 하면

### Member
```java
@Entity @Getter @Setter
public class Member {

    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    @Column(name = "USERNAME")
    private String username;

    @Column(name =  "TEAM_ID")
    private Long teamId;
}
```
### Team
```java
@Entity @Getter @Setter
public class Team {
    @Id @GeneratedValue
    @Column(name = "TEAM_ID")
    private Long id;
    private String name;

}
```

Main 클래스에
```java
//팀 저장
Team team = new Team();
team.setName("TeamA");
em.persist(team);
//멤버 저장
Member member = new Member();
member.setUsername("member1");
member.setTeamId(team.getId()); //em.persist 하면 아이디의 값이 들어간다em.persist(member);             // pk 값이 세팅되야 영속상태가 된다

//조회
Member findMember = em.find(Member.class, member.getId());
Team findTeam = em.find(Team.class, team.getId());
```

연관관계가 없기때문에 이렇게 해야된다 객체지향적이지 않다

> 객체를 테이블에 맞추어 데이터 중심으로 모델링하면, 협력 관계를 만들 수 없다.
> - 테이블은 외래키로 조인을 사용해서 연관된 테이블을 찾는다.
> - 객체는 참조를 사용해서 연관된 객체를 찾는다.
> - 테이블과 객체 사이에는 이런 큰 간격이 있다.

## 단방향 연관관계

<img src="src/data21.png">
객체 지향스럽게 모델링 한 것이다
멤버의 teamId 는 Team 클래스의 참조값을 그대로 가져왔다

그리고 Member class 에
```java
@Entity
public class Member {

    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    @Column(name = "USERNAME")
    private String username;

//    @Column(name =  "TEAM_ID")
//    private Long teamId;
    @ManyToOne
    @JoinColumn(name = "TEAM_ID")
    private Team team;
}
```

일단 원래 있었던 private Long teamId 를 지우고

private Team team 으로 Team 클래스의 참조값을 그래도 가져온다
그다음에 Team 이랑 Member 랑 누가 '다' 고 누가 '일' 일까? 하나의 팀에 여러 맴버가 있을 수
있기 때문에 멤버가 N 이고 팀이 1 이다 그래서 멤버입장에서는 @ManyToOne 이라는 어노테이션으로
매핑을 해야한다.

그리고 Member class 에 레퍼런스와 Member table 에 FK 와 매핑을 해야한다 JoinColumn 어노테이션
으로 name 값에 실제 칼럼명 TEAM_ID 로 주면 된다 이러면 매핑이 끝난다

<img src="src/data22.png">

> 이렇게 매핑이 끝난다. Team team 과 TEAM_ID(FK) 와 연관관계 매핑

```java
//팀 저장
Team team = new Team();
team.setName("TeamA");
em.persist(team);
//회원 저장
Member member = new Member();
member.setUsername("member1");
member.setTeam(team);   //단방향 연관관계 설정, 참조 저장 
em.persist(member);            
//조회
Member findMember = em.find(Member.class, member.getId());
Team findTeam = findMember.getTeam();

```


