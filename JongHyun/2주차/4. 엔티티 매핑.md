# 엔티티 매핑 소개

* 객체와 테이블 매핑 : `@Entity`, `@Table`
* 필드와 컬럼 매핑 : `@Column`
* 기본 키 매핑 : `@Id`
* 연관관계 매핑 : `@ManyToOne`, `@JoinColumn`

## 객체와 테이블 매핑

* `@Entity`가 붙은 클래스는 `JPA`가 관리해주며 이런 클래스를 `엔티티` 라고 한다.
* `JPA`를 사용해서 테이블과 매핑할 클래스는 `@Entity`가 필수적이다.

주의사항

 * 기본 생성자 필수(파라미터가 없는 `public` 또는 `protected` 생성자)
   - `JPA` 구현체가  리플렉싱 같은 기술들을 사용해 객체를 프록싱하는 작업들을 하기때문에 생성자가 필요하다.
 * `final` ,`enum`, `interface`, `inner` 키워드는 클래스는 사용해서는 안된다. 
 * 디비에 저장할 필드에는 `final`을 사용해서는 안된다.

코드 예시

```java

@Entity
public class Member {
    @Id
    private Long id;
    private String name;

    public Member() {}
    
}

```

> 위와 같이 클래스에 `@Entity` 에너테이션을 추가한 클래스가 엔티티 클래스가 되며 `JPA`가 이를 인식해 관리하게 된다.

## `@Entity` 속성 정리

* 속성 name
  * `JPA`에서 사용할 엔티티 이름을 지정한다.
  * 기본값으로는 클래스 이름을 그대로 사용한다.
  * 같은 클래스 이름이 없으면 가급적 기본값을 사용한다.

## `@Table`

`@Table`은 엔티티와 매핑할 테이블을 지정해준다.

| 속성                | 기능                    | 기본값           |
|-------------------|-----------------------|---------------|
| name              | 매핑할 테이블 이름            | 엔티티 이름을 사용한다. |
| catalog           | 데이터 베이스 catalog 매핑    |               |
| schema            | 데이터 베이스 schema 매핑     |               |
| uniqueConstraints | DDL 생성 시에 유니크 제약 조건 생성 |               |

## 데이터 베이스 스키마 자동 생성

* `DDL`을 애플리케이션 실행 시점에 자동 생성
  - 애플리케이션 실행 시점에 테이블을 알아서 만들어줌
* 테이블 중심 -> 객체 중심
  - 필요하면 테이블을 알아서 만들어주어서 객체 중심적인 개발이 가능하다.
* 데이터베이스 방언을 활용해서 데이터베이스에 맞는 적절한 `DDL` 생성
* 이렇게 생성된 `DDL`은 개발 장비에서만 사용해야한다.
* 생성된 `DDL`은 운영서버에서는 사용하지 않거나, 적절히 다듬은 후에 사용한다.


## 데이터베이스 스키마 자동 생성 속성

`persisitence.xml` 파일의 
`hinerbate.hbm2ddl.auto` 속성으로 데이터베이스 스키마를 어떻게 생성해줄것인지 세팅하는 속성이다.
> 예시 코드 `<property name="hinerbate.hbm2ddl.auto" value="create">`

| 옵션          | 설명                               |
|-------------|----------------------------------|
| create      | 기존테이블 삭제 후 다시 생성 (DROP + CREATE) |
| create-drop | create 와 같으나 종료시점에 테이블 DROP      |
| update      | 변경분만 반영(운영 DB에는 사용하면 안됨)         |
| validate    | 엔티티와 테이블이 정상 매핑되었는지만 확인          |
| none        | 사용하지 않음                          |

### 스키마 자동 생성 시의 주의 사항
 * 운영 장비에는 절대 `create`, `create-drop`, `update` 를 사용하면 안된다.
 * 개발 초기 단계는 `create` 또는 `update`
 * 테스트 서버는 `update` 또는 `validate`
 * 스테이징과 운영 서버는 `validate` 또는 `none`

> 결론은 혼자 개발하는 로컬 환경에서만 자유롭게 사용하고   
> 여러명이서 같이 개발하는 테스트 서버나 운영서버에서는 가급적 사용하지 않는것을 권장한다.


## DDL 생성 기능
* 제약 조건 추가 : 회원 이름은 필수이고, 10자 초과가 되면 안된다고 하면
 - `@Column(nullable = false, length = 10)`
* 유니크 제약조건 추가
 - `@Table(uniqueConstraints = {@UniqueConstraint( name = "NAME_AGE_UNIQUE",  columnNames = {"NAME", "AGE"} )})`
> `DDL` 생성 기능은 `DDL`는 자동 생성할 때만 사용되고 `JPA`의 실행 로직에는 영향을 주지 않는다.

## 필드와 컬럼 매핑

### 예제 요구사항

1. 회원은 일반 회원과 관리자로 구분해야한다.
2. 회원 가입일과 수정일이 있어야 한다.
3. 회원을 설명할 수 있는 필드가 있어야 한다. 이 필드는 길이 제한이 없다.

### 요구사항에 따른 예시 코드

```java
 @Entity
 public class Member {
         @Id
         private Long id;
         
         @Column(name = "name")
         private String username;
         
         private Integer age;
         
         @Enumerated(EnumType.STRING)
         private RoleType roleType;
         
         @Temporal(TemporalType.TIMESTAMP)
         private Date createdDate;
         
         @Temporal(TemporalType.TIMESTAMP)
         private Date lastModifiedDate;
         
         @Lob
         private String description;
}

```

> `@Column(name = "name")`   
  `private String username;`   
> : 변수 이름은 `username` 이지만, 디비에는 `name` 으로 하고 싶을때 사용

> `private Integer age;`   
> : `Integer` 타입을 사용하면 가장 적절한 숫자 타입으로 바꿔서 테이블 생성해줌

> `@Enumerated(EnumType.STRING)`   
  `private RoleType roleType;`   
> : 디비에는 `enum` 타입이 없지만 `enum`타입을 사용하고 싶으면 `@Enumerated()` 를 사용하면 된다.

> `@Temporal(TemporalType.TIMESTAMP)`  
  `private Date createdDate;`   
> : 날짜 타입을 사용하고 싶을 때는 `@Temporal(TemporalType.TIMESTAMP)` 를 사용한다.
> 자바의 `Date` 타입에는 날짜와 시간이 다 포함되어 있지만
> 데이터베이스의 `Date` 타입은 날짜와 시간을 구분해서 사용하기 때문에
> `TemporalType`  으로 매핑을 해줘야 한다.
> `TemporalType` 의 종류로는 `DATE`, `TIME`, `TIMESTAMP` 가 있다.

> `@Lob`
> `private String description;` 
> : 데이터베이스에 varchar를 넘어서는 컨텐츠를 넣고 싶을때 사용하는 `clob` , `blob` 형으로 매핑해준다.

